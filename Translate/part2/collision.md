# Коллизия

Возможность перемещать ракетку, конечно, прекрасная, но нам нужен еще один объект для игры: мячик!
Как и с ракеткой, первым делом мы должны создать тайл для мяча и загрузить его в VRAM.

## Графика

Добавьте этот участок кода в конец файла:
```rgbasm,linenos,start={{#line_no_of "" ../../unbricked/collision/main.asm:ball-sprite}}
{{#include ../../unbricked/collision/main.asm:ball-sprite}}
```

Теперь скопируйте данные куда-нибудь в VRAM после копирования тайлов ракетки.
```rgbasm,linenos,start={{#line_no_of "" ../../unbricked/collision/main.asm:ball-copy}}
{{#include ../../unbricked/collision/main.asm:ball-copy}}
```

Также нужно инициализировать объект в OAM, вставьте следующее после ракетки.
```rgbasm,linenos,start={{#line_no_of "" ../../unbricked/collision/main.asm:oam}}
{{#include ../../unbricked/collision/main.asm:oam}}
```

Когда мяч отскакивает от стенки, он меняет направление движения по x и y, этим самым отправляясь в разные стороны.
Давайте создадим две переменные, которые будут следить за направлением мяча: `wBallMomentumX` и `wBallMomentumY`.
```rgbasm,linenos,start={{#line_no_of "" ../../unbricked/collision/main.asm:ram}}
{{#include ../../unbricked/collision/main.asm:ram}}
```

Нам нужно инициализировать переменные перед входом в игровой цикл, поэтому давайте установим им начальное значение сразу после операции с OAM.
Когда wBallMomentumX равняется 1, а wBallMomentumY равняется -1, мяч будет лететь в правый верхний угол.
```rgbasm,linenos,start={{#line_no_of "" ../../unbricked/collision/main.asm:init}}
{{#include ../../unbricked/collision/main.asm:init}}
```

## Предварительные работы

Теперь самое веселое!
Добавьте этот участок кода в начало игрового цикла, он двигает мяч, смотря на значения переменных.
Обратите внимание, что мы используем `+ 4` для Y и `+ 5` для X (координатам мяча).
Этот метод обращения к объекту может показаться достаточно кустарным, однако мы работаем с двумя, поэтому можем пока оставить все как есть.
В будущем мы воспользуемся гораздо более простым способом работы с OAM.
```rgbasm,linenos,start={{#line_no_of "" ../../unbricked/collision/main.asm:momentum}}
{{#include ../../unbricked/collision/main.asm:momentum}}
```

Вы, наверное, захотите перекомпилировать игру, чтобы увидеть изменения.
Если вы это сделаете, то мяч не будет скакать туда-сюда, а просто вылетет за экран.

Чтобы исправить эту проблему, нам нужно добавить обработку коллизий мяча.
Так как нам придется проверять коллизию несколько раз, мы напишем функцию для этого.

::: tip

Пожалуйста, не останавливайтесь на деталях в этой функции, она использует техники и инстркуции, которые мы еще не проходили.
Ее суть в том, что она конвертирует позицию спрайта в адрес на тайлмапе.
Таким образом, мы можем проверить тайл мяча на участие в коллизии.

:::

```rgbasm,linenos,start={{#line_no_of "" ../../unbricked/collision/main.asm:get-tile}}
{{#include ../../unbricked/collision/main.asm:get-tile}}
```

Следующая функция называется `IsWallTile`, она будет содержать список тайлов, от который мяч может отскочить.
```rgbasm,linenos,start={{#line_no_of "" ../../unbricked/collision/main.asm:is-wall-tile}}
{{#include ../../unbricked/collision/main.asm:is-wall-tile}}
```

Эта функция может выглядить странно на первый взгляд.
Вместо записи результата в *регистр*, например `a`, мы возвращаем его в качестве [*флага*](../part1/operations.md#flags): `Z`!
Если тайл совпадает, функция находит стену, завершается, включает флаг `Z`.
